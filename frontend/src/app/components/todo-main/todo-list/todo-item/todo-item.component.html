<!-- src/app/components/todo-main/todo-list/todo-item/todo-item.component.html -->
<div
  class="bg-white rounded-lg shadow-sm mb-3 overflow-hidden group"
  [class.border-l-4]="todo?.completed"
  [class.border-green-500]="todo?.completed"
>
  <!-- Header Row (Modified for create mode) -->
  <div
    class="px-4 py-2 flex items-center space-x-4 hover:bg-gray-50"
    [class.cursor-pointer]="mode === 'display'"
    (click)="mode === 'display' && toggleExpand()"
  >
    <div class="flex items-center gap-2">
      <!-- Checkbox (hidden in create mode) -->
      <app-checkbox
        *ngIf="mode !== 'create'"
        [checked]="todo?.completed || false"
        (checkedChange)="onStatusChange($event)"
        (click)="$event.stopPropagation()"
        [disabled]="mode !== 'display'"
      />
      <!-- Placeholder for checkbox spacing in create mode -->
      <div *ngIf="mode === 'create'" class="w-5"></div>

      <span
        class="flex-grow text-gray-900"
        [class.line-through]="todo?.completed"
      >
        {{ mode === "create" ? "New TO-DO" : todo?.title }}
      </span>
    </div>

    <div class="ml-auto flex gap-2">
      <!-- Save Button -->
      <app-button
        *ngIf="(mode === 'create' || mode === 'edit') && todoForm.dirty"
        variant="icon"
        (clicked)="onSubmit(); $event.stopPropagation()"
        [disabled]="!todoForm.valid"
        [class]="
          isExpanded
            ? 'visible bg-green-100 hover:bg-green-200'
            : 'invisible group-hover:visible bg-green-100 hover:bg-green-200'
        "
      >
        <ng-icon name="heroCheck" size="24" class="text-green-700"></ng-icon>
      </app-button>

      <!-- Edit/Cancel Button -->
      <app-button
        variant="icon"
        (clicked)="
          mode === 'edit' ? cancelEdit() : startEdit(); $event.stopPropagation()
        "
        [class]="
          isExpanded
            ? 'visible bg-blue-100 hover:bg-blue-200'
            : 'invisible group-hover:visible bg-blue-100 hover:bg-blue-200'
        "
      >
        <ng-icon
          [name]="mode === 'edit' ? 'heroXMark' : 'heroPencilSquare'"
          size="24"
          [class]="mode === 'edit' ? 'text-red-700' : 'text-blue-700'"
        ></ng-icon>
      </app-button>

      <!-- Delete Button -->
      <app-button
        variant="icon"
        (clicked)="onDeleteClick($event)"
        [class]="
          isExpanded
            ? 'visible bg-red-100 hover:bg-red-200'
            : 'invisible group-hover:visible bg-red-100 hover:bg-red-200'
        "
      >
        <ng-container *ngIf="!isDeleteConfirming">
          <ng-icon name="heroTrash" size="24" class="text-red-700"></ng-icon>
        </ng-container>
        <span
          *ngIf="isDeleteConfirming"
          class="text-sm font-medium text-red-700"
        >
          delete?
        </span>
      </app-button>
    </div>
  </div>

  <!-- Edit/Create Mode Form -->
  <form
    [formGroup]="todoForm"
    (ngSubmit)="onSubmit()"
    *ngIf="mode !== 'display' || isExpanded"
    class="p-4 space-y-4 bg-gray-50"
  >
    <!-- Title Input -->
    <div *ngIf="mode !== 'display'" class="space-y-1">
      <label class="block text-sm font-medium text-gray-700">Title</label>
      <input
        type="text"
        formControlName="title"
        placeholder="Enter todo title"
        class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-1 focus:ring-blue-500 focus:border-blue-500"
      />
      <p
        *ngIf="todoForm.get('title')?.errors?.['required'] && todoForm.get('title')?.touched"
        class="text-red-500 text-sm"
      >
        Title is required
      </p>
    </div>

    <!-- Description Input -->
    <div class="space-y-1">
      <label class="block text-sm font-medium text-gray-700">Description</label>
      <textarea
        formControlName="description"
        [readonly]="mode === 'display'"
        placeholder="Enter description"
        class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-1 focus:ring-blue-500 focus:border-blue-500"
      >
      </textarea>
    </div>

    <!-- Due Date Input -->
    <div class="space-y-1">
      <label class="block text-sm font-medium text-gray-700">Due Date</label>
      <input
        type="date"
        formControlName="due_date"
        [readonly]="mode === 'display'"
        class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-1 focus:ring-blue-500 focus:border-blue-500"
      />
    </div>
  </form>
</div>
